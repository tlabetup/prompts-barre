Contexte :

- Compétence professionnelle ciblée : """{{ professional_skill }}"""
- Objectifs pédagogiques : """{{ objectives }}"""
- Contenu du module : """{{ all_content }}"""
- Connaissances complémentaires autorisées : """{{ knowledge_base | rag(professional_skill , 'mmr', 6000) }}"""
- Public cible : """{{ target_audience }}"""
- Instructions auteur : """{{ module_instructions }}"""
- Instructions formateur : """{{ trainer_instructions }}"""
- Langue de génération : """{{ language }} ({{ language_code }})"""

{# Détermination du niveau de formalité #}
{% if 'tutoyer' in module_instructions|lower or 'tutoie' in module_instructions|lower or 'tutoiement' in module_instructions|lower or 'utilise le tu' in module_instructions|lower %}
  {% set formality = "tutoiement" %}
{% else %}
  {% set formality = "vouvoiement" %}
{% endif %}

RÈGLE DE FORMALITÉ — STRICTE
- Si tutoiement demandé → tutoyer partout
- Sinon → vouvoiement
- Aucune alternance.
- Aucune neutralisation impersonnelle.

MISSION

Générer EXACTEMENT 3 situations d’entraînement professionnelles, immersives et variées, directement issues du contenu du module.

ANALYSE INTERNE (NE PAS AFFICHER)

Avant de générer :

1. Identifier les notions clés réellement présentes dans :
- le contenu du module
- la base de connaissances complémentaire
2. Sélectionner 3 angles différents pour entraîner la compétence :
- application opérationnelle
- interaction / communication
- analyse / décision
3. Construire des situations réalistes inspirées du module,
sans copier un exemple exact,
mais en transposant les principes dans des contextes crédibles.
4. Adapter le niveau :
- débutant → situation fréquente
- avancé → situation ambiguë ou complexe
5. Vérifier que chaque scénario :
- entraîne concrètement la compétence
- place l’apprenant au centre
- ne contient aucun indice de réponse
- respecte la formalité demandée

STRUCTURE OBLIGATOIRE PAR EXERCICE

- 80 à 120 mots au total
- 60–80 mots : contexte + protagoniste + situation
- 15–30 mots : dialogue direct (guillemets obligatoires + saut de ligne avant et après)
- 10–20 mots : consigne claire + format attendu

CONTRAINTES ESSENTIELLES

- Prénoms rares, internationaux, non stéréotypés
- Protagonistes distincts pour chaque exercice
- Dialogue obligatoire
- Saut de ligne avant et après le dialogue
- Apprenant au centre de l’action
- Immersion narrative forte mais claire
- Aucune solution implicite
- Basé exclusivement sur le contenu fourni
- Pas de “Imagine” ou “Imaginez”
- Finir par préciser le mode de réponse :
- oral → durée en secondes
- écrit → “en quelques points”
- L’apprenant peut toujours répondre oralement ou par écrit,
mais le moyen le plus naturel doit être suggéré.

FORMAT STRICT DE SORTIE

{
"success": "true",
"trainings": [
{
"title": "...",
"scenario": "..."
}
]
}

CONTRÔLE FINAL (SILENCIEUX)

- 3 scénarios réellement différents
- 3 contextes professionnels distincts
- 3 protagonistes différents
- Compétence clairement entraînée
- Respect formalité
- Respect langue
- Respect structure
- JSON strictement valide
