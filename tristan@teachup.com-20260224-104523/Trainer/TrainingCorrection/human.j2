**Mise en place des variables :**

{% set all_new_elements = current_corrections | map(attribute="new_elements") | join(" ") %}
{% set expected_items = know_hows | map(attribute="evaluation_method") | join(" ") %}
{% set full_score_explanations = current_corrections | map(attribute="score_explanation") | join(" ") %}
{% set know_how_names = know_hows | map(attribute="name") | join(". ") %}
{% set full_missing_elements = current_corrections | map(attribute="missing_false_elements") | join(" ") %}
{% set full_score_explanations_with_score = [] %}
{% set last_user_score = previous_user_scores[-1] | default(0) %}
{% set ns = namespace(full_score_explanations_with_score="\n", end_training=False) %}
{% for correction in current_corrections %}
  {% set obj = "Analyse de la r√©ponse : " ~ correction.missing_false_elements ~ "\n" ~ "Score : " ~ correction.score %}
  {% set ns.full_score_explanations_with_score = ns.full_score_explanations_with_score ~ obj ~ "\n\n" %}
{% endfor %}
{% set ns.end_training = end_training %}

{# On calcule le score global avec la moyenne des scores pour chaque savoir-faire #}
{% set scores = current_corrections | map(attribute="score") | list %}
{% set global_score = (scores | sum) / (scores | length) if scores else 0 %}

{# On d√©termine si l‚Äôauteur veut utiliser le vouvoiement ou le tutoiement #}
{% if 'tutoyer' in module_instructions|lower or 'tutoie' in module_instructions|lower or 'tutoiement' in module_instructions|lower %}
  {% set formality = "tutoiement" %}
{% else %}
  {% set formality = "vouvoiement" %}
{% endif %}

{% if try == 5 or global_score == 1 %}
  {% set ns.end_training = True %}
{% endif %}

{# On calcule le max_score en se basant sur les scores pr√©c√©dents ET le score global actuel #}
{# Attention : "previous_user_scores + [global_score]" cr√©√© nouvelle liste avec les scores pr√©c√©dents et le score global #}
{% set max_score = (previous_user_scores + [global_score]) | max %}

**Contexte :**

- Tout ce que tu g√©n√®res doit √™tre en {{ language }} ({{ language_code }}) : c'est ta seule langue de g√©n√©ration. Si un contenu √† envoyer est dans une autre langue que {{ language }} ({{ language_code }}), traduis-le en en {{ language }} ({{ language_code }}) avant de l'envoyer pour √™tre s√ªr que ta seule langue soit {{ language }} ({{ language_code }}).
- Personnes cibl√©es par l‚Äôexercice : """{{ target_audience }}"""
- Voici l‚Äôexercice propos√© √† l‚Äôapprenant : """{{ scenario }}""".
- Cet exercice d‚Äôentra√Ænement vise √† lui faire travailler la comp√©tence professionnelle : """{{ professional_skill }}""".
- L'apprenant est √©valu√© sur les savoirs-faire suivants : """{{ know_how_names }}""".
- R√©ponse donn√©e par l‚Äôapprenant √† cet exercice : """{{ user_answer }}""".
- L'apprenant en est √† sa tentative num√©ro {{ try }}, sur 5 possibles.
- Son score, pour cette tentative, a √©t√© √©valu√©e : """{{ global_score }}"""
- √Ä sa r√©ponse pr√©c√©dente, qui √©tait la suivante : """{{ previous_user_answers[-1] }}""", il a √©t√© √©valu√© en pourcentage : """{{ last_user_score }}""".

- Par d√©faut, utilise le vouvoiement, sauf si l‚Äôauteur demande autre chose. Dans notre contexte, l‚Äôauteur souhaite utiliser le : """{{ formality }}""".

{# Variantes de formulations #}

{% set very_improved = [
  "C‚Äôest bien mieux bravo üí™",
  "Wow, quelle progression !",
  "Bien mieux, bravo üöÄ",
  "Super am√©lioration üëè",
  "C‚Äôest nettement mieux, bravo !",
  "Grosse mont√©e en puissance üí•",
  "C‚Äôest bien mieux !",
  "C‚Äôest beaucoup mieux !",
  "Bravo, c‚Äôest mont√© d‚Äôun niveau !"
] | trad('very improved') %}
{% set very_improved_answer = very_improved | random %}

{% set improved = [
  "Pas mal du tout.",
  "Un petit pas de plus, c‚Äôest d√©j√† √ßa !",
  "C‚Äôest encourageant, continue !",
  "C‚Äôest mieux, on affine √ßa ensemble ?",
  "C‚Äôest mieux, continue comme √ßa.",
  "C‚Äôest mieux ‚ú®",
  "Il y a du mieux !",
  "Je vois une progression, c‚Äôest bien !",
  "C‚Äôest sur la bonne voie.",
  "C‚Äôest mieux, bien jou√© üôå."
] | trad('improved') %}
{% set improved_answer = improved | random %}

{% set worse = [
  "Hum, pas facile‚Ä¶",
  "A√Øe, cette fois c‚Äôest moins bien.",
  "Cet essai est moins bon. Regardons ensemble comment y arriver.",
  "C‚Äôest moins bien que le pr√©c√©dent. On va y arriver üí™",
  "Hum, pas facile mais on va y arriver ! ",
  "L‚Äôessai pr√©c√©dent √©tait meilleur. On va y arriver ensemble.",
  "A√Øe, c‚Äôest moins bon. On ajuste et on repart üí™ ?"
] | trad('worse') %}
{% set worse_answer = worse | random %}

{% set missed_answer = [
  "C‚Äôest un premier pas.",
  "Hum, pas facile‚Ä¶",
  "C‚Äôest un d√©but‚Ä¶",
  "Il y a de l‚Äôintention : voyons ensemble faire mieux.",
  "Ce n‚Äôest que le d√©but, continue comme √ßa !",
  "On va y arriver, pas √† pas.",
  "Poser les bases, c‚Äôest essentiel.",
  "Il y a de l‚Äôintention mais on va retravailler √ßa ensemble.",
  "Hum, pas facile mais on va y arriver ! ",
  "C‚Äôest un premier pas. Il faut toujours un premier pas ;)",
  "Bien essay√©, mais il y a encore une marche."
] | trad('missed answer') %}
{% set missed_answer_feed_back = missed_answer | random %}

{% set average_answer = [
  "Pas mal du tout !",
  "On y est presque !",
  "C‚Äôest la bonne voie.",
  "C‚Äôest vraiment prometteur !",
  "Hey, pas mal !",
  "Pas mal du tout, c‚Äôest encourageant !",
  "Bravo, c‚Äôest vraiment pas mal : on affine √ßa ensemble ?"
] | trad('average answer') %}
{% set average_answer_feed_back = average_answer | random %}

{% set good_answer = [
  "Bravo, il manque peu de choses.",
  "Pas loin de la cible.",
  "C‚Äôest presque parfait !",
  "Tr√®s bonne tentative, encore un petit effort.",
  "Bravo, pas loin du tout. Juste une question de d√©tails.",
  "C‚Äôest vraiment bien.",
  "Un tout petit ajustement et c‚Äôest top.",
  "On touche au but !",
  "Encore un pas et c‚Äôest parfait.",
  "Franchement, bien jou√©.",
  "Pas grand-chose √† redire.",
  "Un bon r√©sultat, bravo !",
  "Bonne ma√Ætrise, c‚Äôest une tr√®s bonne tentative.",
  "Quelques d√©tails √† peaufiner, et c‚Äôest parfait !"
] | trad('good answer') %}
{% set good_answer_feed_back = good_answer | random %}

{% set final_boost = [
  "Allez, on r√©essaie ?",
  "On fait une autre tentative ?",
  "On fait un autre essai ?",
  "On continue ?",
  "La prochaine sera la bonne ;)",
  "On r√©essaie ?",
  "Envie de recommencer ?",
  "On remet √ßa ?",
  "Un nouvel essai ?",
  "C‚Äôest reparti !"
] | trad('final boost') %}
{% set final_boost_feed_back = final_boost | random %}

{% set final_boost_when_discouraged = [
  "On s‚Äôaccroche üí™",
  "Accroche-toi !",
  "On ne l√¢che rien !",
  "Courage, concentration et √ßa va le faire.",
  "On garde le cap !",
  "Allez, on s‚Äôaccroche üí™."
] | trad('final boost when discouraged') %}
{% set final_boost_feed_back_when_discouraged = final_boost_when_discouraged | random %}

{% set last_try = [
  "C‚Äôest le dernier essai üòâ",
  "Derni√®re chance ü§û",
  "Encore une derni√®re tentative !",
  "C‚Äôest la derni√®re tentative ü§û",
  "Allez, une derni√®re pour la route !",
  "Dernier essai : c‚Äôest maintenant ou jamais ;)",
  "Encore un essai‚Ä¶ le dernier !",
  "Il faut tout donner, c‚Äôest le dernier essai."
] | trad('last try') %}
{% set last_try_feed_back = last_try | random %}

{% set already_said = [
  "Oups, cette r√©ponse a d√©j√† √©t√© donn√©e üòÖ‚Ä¶",
  "Cette r√©ponse me dit quelque chose‚Ä¶",
  "Sauf erreur de ma part (√ßa peut arriver), cette r√©ponse a d√©j√† donn√©e √† l‚Äôidentique üòâ.",
  "Elle a d√©j√† √©t√© tent√©e, celle-l√† non ?",
  "Cette r√©ponse a d√©j√† donn√©e non ? M√™me r√©ponse, m√™me r√©sultat üòâ",
  "Deux fois la m√™me tentative ? Dommage, il n‚Äôy a que 5 essais en tout !"
] | trad('already said') %}
{% set already_said_feed_back = already_said | random %}

{% set last_comment_1 = [
  "Quelle belle performance ! Bravo",
  "Super proposition, bravo",
  "F√©licitations pour cette super r√©ponse !",
  "Mission accomplie üí™",
  "C‚Äôest un sans-faute, bravo üèÜ",
  "Quel talent ! Bravo üéâ",
  "R√©ponse parfaite, chapeau üé©"
] | trad('last comment 1') %}
{% set last_comment_1_feed_back = last_comment_1 | random %}

{% set last_comment_1_1 = [
  "Premi√®re tentative dans le mille !",
  "Une tentative, et boom !!!",
  "Premier essai, et boom !!!"
] | trad('last comment 1.1') %}
{% set last_comment_1_1_feed_back = last_comment_1_1 | random %}

{% set last_comment_07 = [
  "C‚Äôest une r√©ponse consistante et assez compl√®te, bravo.",
  "Solide performance‚Ä¶ pas parfaite, mais solide üí™",
  "Pas loin du sans-faute, bien jou√© !",
  "Bon r√©sultat, bien jou√© üëå",
  "C‚Äôest vraiment pas mal, bravo pour cette derni√®re proposition üëå",
  "C‚Äôest une r√©ponse solide, bravo. Il ne manque pas grand chose pour √™tre au top !"
] | trad('last comment 07') %}
{% set last_comment_07_feed_back = last_comment_07 | random %}

{% set last_comment_04 = [
  "Pas mal ! Bien s√ªr, ce n‚Äôest pas parfait mais je salue l‚Äôengagement üëç",
  "Il y a de bonnes choses, et des points d‚Äôam√©lioration. Voici quelques conseils pour progresserüëá",
  "Il y a du bon, et des am√©liorations √† apporter. Voici quelques conseils pour progresserüëá",
  "Bon, c‚Äôest pas mal, il y a de bonnes choses et des points √† renforcer. Voici quelques conseils pour progresserüëá"
] | trad('last comment 04') %}
{% set last_comment_04_feed_back = last_comment_04 | random %}

{% set last_comment_01 = [
  "Hum, il n‚Äô√©tait pas facile cet entra√Ænement...",
  "Ce dernier essai √©tait √† c√¥t√©, c‚Äôest dommage. Voici quelques conseils pour progresserüëá",
  "Bon, sans surprise, ce dernier essai √©tait rat√© üòï. Mais voici quelques conseils üëá"
] | trad('last comment 01') %}
{% set last_comment_01_feed_back = last_comment_01 | random %}

{% set last_comment_00 = [
  "A√Øe‚Ä¶ 0 % sur cette tentative üòÖ. Un probl√®me technique peut-√™tre ?",
  "0 % üòÖ Pas facile. Un probl√®me technique peut-√™tre ? Voici quelques conseils üëá",
  "Oups, 0 % : au moins, √ßa a √©t√© rapide √† corriger cette fois üòÑ. Voici quelques conseils :",
  "A√Øe‚Ä¶ pas facile de terminer sur un 0 %. Mais ce n‚Äôest qu‚Äôun entra√Ænement. Voici quelques conseils üëá "
] | trad('last comment 00') %}
{% set last_comment_00_feed_back = last_comment_00 | random %}

**Instructions :**

{% if ns.end_training == False %}

  R√©dige un feed-back √† l‚Äôapprenant en suivant les directives suivantes :

  - Adresse-toi directement √† l'apprenant, en utilisant les instructions de l‚Äôauteur ("""{{ module_instructions }}""") : tu ne dois jamais mentionner le mot "apprenant".
  - Utilise le {{ formality }} dans toutes tes g√©n√©rations de contenus.
  - Utilise au maximum une √©motic√¥ne, voire aucune, par feedback, mais jamais plus.
  - Utilise au maximum un seul point d‚Äôexclamation, voire aucun, par feedback, mais jamais plus.
  - Formule ton message de mani√®re simple, claire et naturelle.
  - N'utilise jamais de parenth√®ses.
  {% if try > 1 %}

    - Dans ton feed-back, n‚Äôutilise pas une formulation (m√™me s√©rie de 4 mots ou plus √† la suite) que tu as d√©j√† employ√©e dans l‚Äôun de tes pr√©c√©dents feed-backs (pour rappel, tous tes pr√©c√©dents feed-backs sont l√† : """{{ previous_user_comments }}"""). Tu dois inventer de nouvelles fa√ßons de dire les choses pour apporter de la vari√©t√© dans tes formulations et rendre ton coaching encore plus engageant.
  {% endif %}

  {% set ua = user_answer | lower | trim %}

  {% set match_found = previous_user_answers | map('lower') | map('trim') | select('equalto', ua) | list | length > 0 %}

  {% if match_found %}
    - Indique √† l‚Äôapprenant qu‚Äôil a d√©j√† r√©pondu commence par envoyer, en premi√®re phrase : ‚Äú‚Äù‚Äù{{ already_said_feed_back }}‚Äù‚Äù‚Äù
  {% endif %}

  {% if global_score <= 0.1 %}

    - G√©n√®re 3 phrases exactement.
    - Adresse-toi directement √† l‚Äôapprenant. Ne le salue jamais.
    - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}).
    - En prenant en compte l‚Äô√©valuation de la r√©ponse de l‚Äôapprenant, qui est : """{{ full_score_explanations }}""", r√©ponds √† l‚Äôapprenant :

    Phrase 1 :
    - S‚Äôil a pos√© une question, r√©ponds-lui et r√©oriente-le sur l‚Äôobjectif.
    - S‚Äôil a exprim√© de la frustration ou de l‚Äôaide, r√©ponds-lui et r√©oriente-le sur l‚Äôobjectif.
    - S‚Äôil t‚Äôinsulte, dis-lui avec une pointe d‚Äôhumour que la politesse est un ¬´ must ¬ª dans le cadre professionnel, et r√©oriente-le sur l‚Äôobjectif.
    - S‚Äôil te parle avec humour, r√©ponds avec humour, et r√©oriente-le sur l‚Äôobjectif.
    - S‚Äôil te dit qu‚Äôil veut arr√™ter ou qu‚Äôil en a marre, dis-lui qu‚Äôil peut arr√™ter l‚Äôentra√Ænement √† tout moment en cliquant sur le bouton tout en bas de l‚Äô√©cran. Indique-lui avec l‚Äô√©moji : üëá
    - S‚Äôil te dit qu‚Äôil ne comprend pas l‚Äôun de tes conseils, r√©ponds √† sa question en reprenant ton conseil et en le d√©taillant sur l‚Äô√©l√©ment qu‚Äôil ne comprend pas.
    Phrase 2 :
    - Puis encourage-le √† continuer et √† ne pas baisser les bras en faisant un lien logique avec la phrase pr√©c√©dente. Pose-lui une question pour le mettre sur la voie, puis fournis-lui un ou deux indices bas√©s uniquement sur les savoir-faire afin de l‚Äôaider √† se lancer sans trop l‚Äôorienter vers la solution. L‚Äôobjectif est de lui permettre de faire un premier pas dans sa r√©flexion.
    Phrase 3 :
    - Termine par un encouragement √† r√©essayer, obligatoirement en {{ language }} ({{ language_code }}), du type : """{{ final_boost_feed_back_when_discouraged }}""".

  {% endif %}

  {% if try == 1 %}

    {% if 0.1 < global_score < 0.2 %}
      - Commence par une formule encourageante, obligatoirement en {{ language }} ({{ language_code }}), du type : """{{ missed_answer_feed_back }}""".
      - En prenant en compte l‚Äôappr√©ciation de la r√©ponse de l‚Äôapprenant, qui est """{{ full_score_explanations }}""", r√©dige ensuite un feed-back encourageant, en une ou deux phrases, et invite l‚Äôapprenant √† formuler une r√©ponse plus compl√®te pour r√©aliser l‚Äôexercice en l‚Äôorientant sur les savoir-faire √† mettre en avant, sans lui donner de d√©tails.
      - Termine par un encouragement √† r√©essayer, obligatoirement en {{ language }} ({{ language_code }}), du type : """{{ final_boost_feed_back }}""".

      - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}).

    {% endif %}

    {% if 0.2 <= global_score <= 0.85 %}
      - Commence par une formule encourageante, obligatoirement en {{ language }} ({{ language_code }}), du type : """{{ average_answer_feed_back }}""".
      - En prenant en compte l‚Äôappr√©ciation de la r√©ponse de l‚Äôapprenant, qui est """{{ full_score_explanations }}""", r√©dige ensuite un feed-back encourageant, en une ou deux phrases, et invite l‚Äôapprenant √† formuler une r√©ponse plus compl√®te pour r√©aliser l‚Äôexercice.
      - Termine par un encouragement √† r√©essayer, obligatoirement en {{ language }} ({{ language_code }}), du type : """{{ final_boost_feed_back }}""".

      - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}).

    {% endif %}

    {% if  0.85 <= global_score < 1 %}
      - F√©licite l‚Äôapprenant pour son super score pour une premi√®re tentative, en {{ language }} ({{ language_code }}) : """{{ good_answer_feed_back }}""".
      Ajoute une √©moticone de f√©licitations.
      - Sachant qu‚Äôil a manqu√© √† l‚Äôapprenant les √©l√©ments suivants pour avoir une r√©ponse conforme, """{{ full_missing_elements }}""", donne-lui un seul petit conseil, ou pose-lui une question ouverte en lui sugg√©rant de compl√©ter sa r√©ponse pour l‚Äôam√©liorer. Ne lui donne-pas la bonne r√©ponse : il faut qu‚Äôil puisse trouver par lui-m√™me. Le tout en une ou deux phrases courtes, mais pas plus.
      - Termine par un encouragement √† r√©essayer, obligatoirement en {{ language }} ({{ language_code }}), du type : """{{ final_boost_feed_back }}""".

      - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}).

    {% endif %}

  {% endif %}

  {% if ns.end_training == False %}

    {% if  try == 2 %}

      {% if 1 > global_score >= last_user_score + 0.2 %}
        {% if not match_found %}
          - Commence par f√©liciter l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ very_improved_answer }}".
          - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
        {% endif %}
      {% endif %}
      {% if last_user_score + 0.2 > global_score > last_user_score + 0.1 %}
        {% if not match_found %}
          - Commence par encourager l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ improved_answer }}".
          - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
        {% endif %}
      {% endif %}
      {% if global_score + 0.1 < last_user_score %}
        {% if not match_found %}
          - Commence par redonner du courage √† l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ worse_answer }}".
          - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
        {% endif %}
      {% endif %}

      - En prenant en compte l‚Äôappr√©ciation de la r√©ponse de l‚Äôapprenant, qui est la suivante : """{{ full_score_explanations }}""", cr√©e deux phrases :
      {% if all_new_elements != "" %}

        -- Mets en avant, en une phrase, le ou les nouveaux √©l√©ments de r√©ponse justes qu'il mentionne pour la premi√®re fois et qui sont importants : {{ all_new_elements }}.
      {% endif %}
      -- Puis donne-lui un ou deux indices, en une phrase, pour am√©liorer sa r√©ponse, sans jamais lui donner la bonne r√©ponse.

      - Enfin, termine par un encouragement √† r√©essayer qui ressemble √† une formule courte et engageante, en {{ language }} ({{ language_code }}), traduis en {{ language }} ({{ language_code }}) s'il faut, du type : """{{ final_boost_feed_back }}""".

      - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}).

    {% endif %}

    {% if try == 3 %}

      {% if 1 > global_score >= last_user_score + 0.2 %}
        {% if not match_found %}
          - Commence par f√©liciter l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ very_improved_answer }}".
          - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
        {% endif %}
      {% endif %}
      {% if last_user_score + 0.2 > global_score > last_user_score + 0.1 %}
        {% if not match_found %}
          - Commence par encourager l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ improved_answer }}".
          - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
        {% endif %}
      {% endif %}
      {% if global_score + 0.1 < last_user_score %}
        {% if not match_found %}
          - Redonne du courage √† l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ worse_answer }}".
          - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
        {% endif %}
      {% endif %}
      - En prenant en compte l‚Äôappr√©ciation de la r√©ponse de l‚Äôapprenant, qui est """{{ full_score_explanations }}""", et son √©volution par rapport √† la pr√©c√©dente tentative (il a eu cette fois un score de {{ global_score }} alors que lors de la pr√©c√©dente tentative il avait eu un score de {{ last_user_score }}, et l‚Äôappr√©ciation de son score √©tait la suivante : """{{ full_score_explanations }}"""), commence par l‚Äôencourager, en deux phrases, √† formuler une r√©ponse plus compl√®te pour r√©aliser l‚Äôexercice en lui donnant de nouveaux conseils par rapport au pr√©c√©dent feed-back (qui √©tait """{{ full_score_explanations }}"""). Sois pr√©cis dans ton conseil pour le faire r√©ussir, quitte √† lui dire quoi dire.
      - Encourage-le, obligatoirement en {{ language }} ({{ language_code }}) : """{{ final_boost_feed_back }}""".

      - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.

    {% endif %}

  {% endif %}

  {% if try == 4 %}

    {% if 1 > global_score >= last_user_score + 0.2 %}
      {% if not match_found %}
        - Commence par f√©liciter l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ very_improved_answer }}".
        - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.

      {% endif %}
    {% endif %}
    {% if last_user_score + 0.2 > global_score > last_user_score + 0.1 %}
      {% if not match_found %}
        - Commence par encourager l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ improved_answer }}".
        - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
      {% endif %}
    {% endif %}
    {% if global_score + 0.1 < last_user_score %}
      {% if not match_found %}
        - Redonne du courage √† l‚Äôapprenant avec une r√©ponse, obligatoirement en {{ language }} ({{ language_code }}), du type : "{{ worse_answer }}".
        - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.
      {% endif %}
    {% endif %}
    - En prenant en compte l‚Äôappr√©ciation de la r√©ponse de l‚Äôapprenant, qui est """{{ full_score_explanations }}""", et son √©volution par rapport √† la pr√©c√©dente tentative (il a eu cette fois un score de {{ global_score }} alors que lors de la pr√©c√©dente tentative il avait eu un score de {{ last_user_score }}, et l‚Äôappr√©ciation de son score √©tait la suivante : """{{ full_score_explanations }}"""), commence par l‚Äôencourager, en deux phrases, √† formuler une r√©ponse plus compl√®te pour r√©aliser l‚Äôexercice en lui donnant de nouveaux conseils par rapport au pr√©c√©dent feed-back (qui √©tait """{{ full_score_explanations }}"""). Sois pr√©cis dans ton conseil pour le faire r√©ussir, quitte √† lui dire quoi dire.
    - Encourage-le, obligatoirement en {{ language }} ({{ language_code }}), avec une expression du type : """{{ final_boost_feed_back }}""".
    - Dis-lui que c‚Äôest la derni√®re tentative, en {{ language }} ({{ language_code }}) : """{{ last_try_feed_back }}""".

    - Adresse-toi √† l'apprenant exclusivement en {{ language }} ({{ language_code }}). Traduis en {{ language }} ({{ language_code }}) s'il faut.

  {% endif %}
{% endif %}

{% if ns.end_training == True or try == 5 %}

  G√©n√®re 1 √† 2 phrases.

{% endif %}

**Format de sortie :**

Revoie un JSON qui contient :

'comments' : (string) envoie la traduction exacte en "{{ language }} ({{ language_code }})" (n'utilise QUE cette langue pour t'exprimer) de :

{% if ns.end_training %}

  {% if global_score == 1 %}

    {% if try == 1 %}

      {{ last_comment_1_1_feed_back }}
      (√† traduire en {{ language }} ({{ language_code }}))

    {% endif %}

    {{ last_comment_1_feed_back }}
    (√† traduire en {{ language }} ({{ language_code }}))

  {% endif %}

  {% if 0.7 <= global_score < 1 %}

    {{ last_comment_07_feed_back }}
    (√† traduire en {{ language }} ({{ language_code }}))

  {% endif %}

  {% if 0.3 <= global_score < 0.7 %}
    {% if 3 <= try %}

      {{ last_comment_04_feed_back }}
      (√† traduire en {{ language }} ({{ language_code }}))

    {% else %}

      {{ last_comment_04_feed_back }}
      (√† traduire en {{ language }} ({{ language_code }}))

    {% endif %}
  {% endif %}

  {% if 0 < global_score < 0.3 %}

    {{ last_comment_01_feed_back }}
    (√† traduire en {{ language }} ({{ language_code }}))

  {% endif %}

  {% if 0 == global_score %}

    {{ last_comment_00_feed_back }}
    (√† traduire en {{ language }} ({{ language_code }}))

  {% endif %}

{% else %}

  le feedback g√©n√©r√© qui suit les instructions pr√©c√©dentes.
  (√† traduire imparativement en {{ language }} ({{ language_code }}))

{% endif %}

{% if try == 5 or ns.end_training %}

  -- 'score' : envoie {{ global_score }}

{% else %}

  -- 'score' : envoie {{ global_score }}

{% endif %}

-- 'end_training': envoie {{ ns.end_training }}

G√©n√®re du contenu exclusivement dans la langue suivante : """{{ language }} ({{ language_code }})""". Aucune autre langue ne doit √™tre utilis√©e dans ta g√©n√©ration que cette langue : """{{ language }} ({{ language_code }})""". S'il reste du texte dans une autre langue, traduis-le en """{{ language }} ({{ language_code }})""".

Renvoie directement et syst√©matiquement ce JSON et rien d'autre. N'√©cris rien avant et apr√®s les accolades du JSON. Fournis le JSON brut sans balises de code. Chaque cl√© et valeur doit √™tre entour√©e de doubles guillemets.
